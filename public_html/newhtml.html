<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Opdacht 7</title>

        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script>
            var settings = function (url) {
                this.url = url;
                this.method = "GET";
                this.datatype = "json";
                this.headers = {
                    "authorization": "Basic aW1zOno1MTJtVDRKeVgwUExXZw=="
                };
            };
            //drones settings
            /*var dronesSettings = {
             "url": "https://web-ims.thomasmore.be/datadistribution/API/2.0/drones?format=json",
             "method": "GET",
             "datatype": "json",
             "headers": {
             "authorization": "Basic aW1zOno1MTJtVDRKeVgwUExXZw=="
             }
             };*/
            var dronesSettings = new settings("https://web-ims.thomasmore.be/datadistribution/API/2.0/drones?format=json");
            $.ajax(dronesSettings).done(function (drones) {
                //voor elke drone
                drones.forEach(function (drones) {
                    /*var droneDetailSetting = {
                     "url": "https://web-ims.thomasmore.be/datadistribution/API/2.0/drones/"+drones.id+"?format=json",
                     "method": "GET",
                     "datatype": "json",
                     "headers": {
                     "authorization": "Basic aW1zOno1MTJtVDRKeVgwUExXZw=="
                     }
                     };*/
                    var droneDetailSetting = new settings("https://web-ims.thomasmore.be/datadistribution/API/2.0/drones/" + drones.id + "?format=json");
                    $.ajax(droneDetailSetting).done(function (droneDetails) {
                        /*var fileSetting = {
                         "url": "https://web-ims.thomasmore.be/datadistribution/API/2.0/files?drone_id.is="+droneDetails.id+"&format=json",
                         "method": "GET",
                         "datatype": "json",
                         "headers": {
                         "authorization": "Basic aW1zOno1MTJtVDRKeVgwUExXZw=="
                         }
                         };*/
                        var fileSetting = new settings("https://web-ims.thomasmore.be/datadistribution/API/2.0/files?drone_id.is=" + droneDetails.id + "&format=json");
                        $.ajax(fileSetting).done(function (files) {
                            files.forEach(function (files) {
                                var filesDetailSetting = new settings("https://web-ims.thomasmore.be/datadistribution/API/2.0/files/" + files.id + "?format=json");
                                /*var filesDetailSetting = {
                                 "url": "https://web-ims.thomasmore.be/datadistribution/API/2.0/files/"+files.id+"?format=json",
                                 "method": "GET",
                                 "datatype": "json",
                                 "headers": {
                                 "authorization": "Basic aW1zOno1MTJtVDRKeVgwUExXZw=="
                                 }
                                 };*/
                                $.ajax(filesDetailSetting).done(function (fileDetails) {
                                    $("#tabel").append('<tr>' +
                                            '<td>' + droneDetails.name + '</td>' +
                                            '<td>' + droneDetails.mac_address + '</td>' +
                                            '<td>' + files.id + '</td>' +
                                            '<td>' + fileDetails.date_first_record + '</td>' +
                                            '<td>' + fileDetails.date_last_record + '</td></tr>');
                                }).fail(function () {
                                    //leeg laten anders onverklaarbare error
                                });
                            });
                        }).fail(function () {
                            alert('An error has occurred - you may not have been entered');
                        });
                    }).fail(function () {
                        alert('An error has occurred - you may not have been entered');
                    });
                });
            }).fail(function () {
                alert('An error has occurred - you may not have been entered');
            });
        </script>
    </head>


    <body>
        <div>
            <h1>Opracht 7</h1>
            <table id="tabel">
                <tr> <!-- tabel headers rest automatische append -->
                    <th>Naam drone</th>
                    <th>Mac_adres drone</th>
                    <th>id file</th>
                    <th>Eerste record</th>
                    <th>Laatste Record</th>
                </tr>
            </table>
        </div>

    </body>
</html>